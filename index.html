<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Betting Value Calculator</title>
  <meta name="theme-color" content="#0d6efd" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    #result { white-space: pre-wrap; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Betting Value Strategy</h1>
  <label>Probability (%): <input id="prob" type="number" min="0" max="100" step="0.1" /></label><br />
  <label>Odds: <input id="odds" type="number" min="1" step="0.01" /></label><br />
  <button onclick="calcValue()">Check Value</button>
  <button onclick="getLiveOdds()">Fetch Live Odds</button>
  <p id="result"></p>

  <script>
    function calcValue() {
      const probInput = document.getElementById("prob").value;
      const oddsInput = document.getElementById("odds").value;
      const result = document.getElementById("result");

      // Input validation
      if (!probInput || !oddsInput) {
        result.textContent = "❌ Please enter both probability and odds.";
        return;
      }

      const prob = parseFloat(probInput);
      const odds = parseFloat(oddsInput);

      if (isNaN(prob) || isNaN(odds) || prob < 0 || prob > 100 || odds < 1) {
        result.textContent = "❌ Invalid input. Probability must be 0–100%, odds must be ≥ 1.";
        return;
      }

      const value = (prob / 100) * odds;
      result.textContent =
        value > 1
          ? `✅ Value Bet! (Expected Value: ${value.toFixed(2)})`
          : `❌ No Value (Expected Value: ${value.toFixed(2)})`;
    }

    async function getLiveOdds() {
      const result = document.getElementById("result");
      result.textContent = "⏳ Fetching live odds...";

      try {
        // Ideally, use a proxy or environment variable for the API key
        const res = await fetch(
          'https://api.the-odds-api.com/v4/sports/soccer_epl/odds?regions=eu&markets=h2h&apiKey=YOUR_API_KEY'
        );

        if (!res.ok) {
          throw new Error(`HTTP error! Status: ${res.status}`);
        }

        const data = await res.json();
        if (!data || !data[0] || !data[0].teams || !data[0].bookmakers[0]) {
          throw new Error("Invalid API response structure");
        }

        const first = data[0];
        const teams = first.teams.join(" vs ");
        const odds = first.bookmakers[0].markets[0].outcomes;

        let txt = `${teams}\n`;
        odds.forEach(o => txt += `${o.name}: ${o.price}\n`);
        result.textContent = txt;
      } catch (err) {
        result.textContent = `❌ Error fetching odds: ${err.message}`;
      }
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('✅ Service Worker registered'))
        .catch(err => {
          console.error('❌ Service Worker registration failed', err);
          document.getElementById("result").textContent = "❌ Service Worker registration failed.";
        });
    }
  </script>
</body>
</html>
